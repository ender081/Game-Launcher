<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini RPG — Demo</title>
<style>
  :root{
    --bg:#0b1020;
    --panel:#0f1724;
    --accent:#eab308;
    --muted:#9aa4be;
  }
  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#071028 0%, #0b1020 100%);color:#dde6ff}
  #game-wrap{display:flex;gap:16px;padding:18px;box-sizing:border-box;max-width:1100px;margin:12px auto;}
  #left{flex:1;display:flex;flex-direction:column;align-items:center;gap:12px}
  canvas{background:#081127;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,0.6)}
  #hud{width:100%;display:flex;justify-content:space-between;gap:8px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:10px;border-radius:10px;min-width:150px}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button{background:transparent;color:var(--accent);border:1px solid rgba(234,179,8,0.18);padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px dashed rgba(255,255,255,0.03);color:var(--muted)}
  #overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:50;visibility:hidden;opacity:0;transition:all .18s}
  #overlay.show{visibility:visible;opacity:1}
  #menu{background:#071427;padding:18px;border-radius:14px;min-width:320px;color:#dbe9ff;box-shadow:0 10px 40px rgba(0,0,0,0.6)}
  #menu h1{margin:0 0 8px 0;font-size:20px}
  #menu p{margin:6px 0 14px 0;color:var(--muted)}
  .statline{display:flex;justify-content:space-between;margin:4px 0;font-size:13px;color:var(--muted)}
  #mobile-controls{display:none;position:fixed;bottom:18px;left:50%;transform:translateX(-50%);gap:8px}
  #mobile-controls .btn{width:56px;height:56px;border-radius:12px; background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center;font-weight:700;color:#cfe2ff}
  @media (max-width:900px){
    #game-wrap{flex-direction:column;align-items:center;padding:12px}
    #mobile-controls{display:flex}
    canvas{width:100%;height:auto}
  }
  /* simple in-game combat panel */
  #combat{display:flex;gap:10px;flex-direction:column}
  .combat-row{display:flex;justify-content:space-between;gap:8px}
  .hpbar{height:10px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden}
  .hpfill{height:100%;background:linear-gradient(90deg,#ff5f5f,#ffcd3c)}
  small{color:var(--muted)}
</style>
</head>
<body>
<div id="game-wrap">
  <div id="left">
    <div id="hud" style="width:100%;max-width:800px">
      <div class="panel" style="flex:1">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <strong id="player-name">Hero</strong>
            <div style="font-size:12px;color:var(--muted)">Level <span id="player-level">1</span> • XP <span id="player-xp">0</span></div>
          </div>
          <div style="text-align:right">
            <button id="btn-start">Start</button>
            <button id="btn-pause" class="ghost">Pause</button>
          </div>
        </div>
        <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
          <div style="flex:1">
            <small>HP</small>
            <div class="hpbar"><div id="player-hp-fill" class="hpfill" style="width:100%"></div></div>
          </div>
          <div style="width:90px;text-align:right">
            <small>Gold</small>
            <div id="player-gold">0</div>
          </div>
        </div>
      </div>

      <div class="panel" style="width:220px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Inventory</strong>
          <small id="potion-count">0</small>
        </div>
        <div class="controls">
          <button id="use-potion" class="ghost">Use Potion</button>
          <button id="save-score" class="ghost">Save Score</button>
        </div>
        <div style="margin-top:8px;font-size:12px;color:var(--muted)">
          Kontrol: WASD / Panah. Mobile: tombol bawah.
        </div>
      </div>
    </div>

    <canvas id="game" width="800" height="560"></canvas>

    <div style="display:flex;gap:8px;width:100%;max-width:800px;margin-top:10px">
      <div class="panel" style="flex:1">
        <strong>Status</strong>
        <div class="statline"><span>Enemies Defeated</span><span id="stat-kill">0</span></div>
        <div class="statline"><span>Time Played</span><span id="stat-time">0s</span></div>
      </div>
      <div class="panel" style="width:260px">
        <strong>Top Skor</strong>
        <ol id="highscores" style="padding-left:18px;margin:8px 0 0 0;color:var(--muted)"></ol>
      </div>
    </div>
  </div>

  <div id="right" style="width:320px">
    <div class="panel" style="margin-bottom:12px">
      <h3 style="margin:0 0 6px 0">Mini RPG — Controls</h3>
      <p style="margin:0;color:var(--muted)">Gerakkan karakter, tabrakan dengan musuh memicu pertarungan turn-based. Kalahkan musuh untuk dapat XP & gold. Gunakan potion untuk sembuh.</p>
    </div>

    <div class="panel">
      <h4 style="margin:0 0 8px 0">Detil Player</h4>
      <div class="statline"><span>HP</span><span id="stat-hp">100</span></div>
      <div class="statline"><span>Attack</span><span id="stat-attack">8</span></div>
      <div class="statline"><span>Defense</span><span id="stat-def">2</span></div>
      <div style="margin-top:10px;font-size:13px;color:var(--muted)">
        Versi demo. Ingin fitur seperti quest, shop, atau map editor? Minta saja.
      </div>
    </div>
  </div>
</div>

<!-- overlay for menu / combat -->
<div id="overlay">
  <div id="menu">
    <div id="menu-content">
      <h1>Mini RPG</h1>
      <p id="menu-text">Tekan Start untuk memulai petualanganmu.</p>
      <div id="menu-buttons" style="display:flex;gap:8px;margin-top:12px">
        <button id="menu-start">Start Game</button>
        <button id="menu-close" class="ghost">Tutup</button>
      </div>
    </div>

    <div id="combat-ui" style="display:none">
      <h1 id="combat-title">Pertarungan</h1>
      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <small>Pemain</small>
          <div class="hpbar"><div id="combat-player-hp" class="hpfill" style="width:100%"></div></div>
          <div style="margin-top:8px" id="combat-player-info">Lv 1 • HP: 100</div>
        </div>
        <div style="flex:1">
          <small>Musuh</small>
          <div class="hpbar"><div id="combat-enemy-hp" class="hpfill" style="width:100%"></div></div>
          <div style="margin-top:8px" id="combat-enemy-info">Goblin • HP: 30</div>
        </div>
      </div>

      <div style="margin-top:12px" id="combat-actions">
        <div class="combat-row">
          <button id="act-attack">Serang</button>
          <button id="act-item" class="ghost">Gunakan Potion</button>
          <button id="act-run" class="ghost">Lari</button>
        </div>
        <div style="margin-top:10px;color:var(--muted)" id="combat-log">Giliran pemain...</div>
      </div>
    </div>
  </div>
</div>

<!-- mobile controls -->
<div id="mobile-controls">
  <div class="btn" id="m-up">↑</div>
  <div style="display:flex;gap:6px">
    <div class="btn" id="m-left">←</div>
    <div class="btn" id="m-down">↓</div>
    <div class="btn" id="m-right">→</div>
  </div>
</div>

<script>
/* =========================
   Mini RPG Game (single file)
   ========================= */

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const W = canvas.width;
const H = canvas.height;

// --- Game state ---
let running = false;
let paused = false;
let startTime = 0;
let elapsed = 0;
let enemyKill = 0;

// Simple map (0 = grass, 1 = wall)
const MAP_W = 20, MAP_H = 14;
let tileSize = Math.floor(Math.min(W / MAP_W, H / MAP_H));
if (tileSize < 24) tileSize = 40; // ensure decent size, canvas is sized to 800x560
const map = [];
function generateMap(){
  for(let y=0;y<MAP_H;y++){
    const row=[];
    for(let x=0;x<MAP_W;x++){
      if (x===0||y===0||x===MAP_W-1||y===MAP_H-1) row.push(1);
      else row.push(Math.random()<0.08?1:0);
    }
    map.push(row);
  }
}
generateMap();

// player
const player = {
  x:2, y:2,
  px:2, py:2,
  hpMax:100, hp:100,
  atk:8, def:2, level:1, xp:0,
  gold:0,
  potions:2
};

// enemies list
let enemies = [];

function spawnEnemy(){
  const types = [
    {name:'Goblin', hp:30, atk:6, def:1, xp:10, gold:8},
    {name:'Wolf', hp:40, atk:8, def:2, xp:15, gold:12},
    {name:'Bandit', hp:55, atk:10, def:3, xp:25, gold:20}
  ];
  const t = types[Math.floor(Math.random()*types.length)];
  // spawn at random empty tile
  let tries=0;
  while(tries<200){
    tries++;
    const x = 2 + Math.floor(Math.random()*(MAP_W-4));
    const y = 2 + Math.floor(Math.random()*(MAP_H-4));
    if (map[y][x]===0 && distance(x,y,player.x,player.y)>4){
      enemies.push({
        id:Date.now()+Math.random(),
        x, y, hp:t.hp, hpMax:t.hp, atk:t.atk, def:t.def, name:t.name, xp:t.xp, gold:t.gold
      });
      break;
    }
  }
}

// helper
function distance(x1,y1,x2,y2){ return Math.hypot(x1-x2,y1-y2); }

// spawn a few
for(let i=0;i<4;i++) spawnEnemy();

let keys = {};
window.addEventListener('keydown', e=>{
  keys[e.key.toLowerCase()] = true;
  if (e.key==='Escape') togglePause();
});
window.addEventListener('keyup', e=>{
  keys[e.key.toLowerCase()] = false;
});

// mobile buttons
['m-up','m-down','m-left','m-right'].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('touchstart', e=>{ e.preventDefault(); keys[id.replace('m-','')] = true; });
  el.addEventListener('touchend', e=>{ e.preventDefault(); keys[id.replace('m-','')] = false; });
  el.addEventListener('mousedown', ()=>keys[id.replace('m-','')] = true);
  el.addEventListener('mouseup', ()=>keys[id.replace('m-','')] = false);
});

// UI elements
const btnStart = document.getElementById('btn-start');
const btnPause = document.getElementById('btn-pause');
const overlay = document.getElementById('overlay');
const menu = document.getElementById('menu');
const menuText = document.getElementById('menu-text');
const menuStart = document.getElementById('menu-start');
const menuClose = document.getElementById('menu-close');

btnStart.addEventListener('click', ()=>{ if(!running) openMenu('start'); else resetGame(); });
menuStart.addEventListener('click', ()=>{ startGame(); hideOverlay(); });
menuClose.addEventListener('click', ()=>hideOverlay());
btnPause.addEventListener('click', ()=>togglePause());

document.getElementById('use-potion').addEventListener('click', ()=>usePotion());
document.getElementById('save-score').addEventListener('click', ()=>saveScore());

function openMenu(mode='start'){
  overlay.classList.add('show');
  if(mode==='start'){
    document.getElementById('menu-content').style.display='block';
    document.getElementById('combat-ui').style.display='none';
    menuText.textContent = running ? 'Game sedang berjalan. Mulai ulang?' : 'Tekan Start untuk memulai petualanganmu.';
  }
}
function hideOverlay(){ overlay.classList.remove('show'); }

function togglePause(){
  if(!running) return;
  paused = !paused;
  btnPause.textContent = paused ? 'Resume' : 'Pause';
  btnPause.classList.toggle('ghost', !paused);
  if(paused) openMenu('start'); else hideOverlay();
}

// ===== Combat system (overlay-based) =====
const combatUI = document.getElementById('combat-ui');
const combatLogEl = document.getElementById('combat-log');
const combatPlayerHP = document.getElementById('combat-player-hp');
const combatEnemyHP = document.getElementById('combat-enemy-hp');
const combatPlayerInfo = document.getElementById('combat-player-info');
const combatEnemyInfo = document.getElementById('combat-enemy-info');

let inCombat = false;
let currentEnemy = null;
let playerTurn = true;

document.getElementById('act-attack').addEventListener('click', ()=>combatPlayerAttack());
document.getElementById('act-item').addEventListener('click', ()=>combatUsePotion());
document.getElementById('act-run').addEventListener('click', ()=>combatRun());

function startCombat(enemy){
  inCombat = true;
  currentEnemy = enemy;
  playerTurn = true;
  overlay.classList.add('show');
  document.getElementById('menu-content').style.display='none';
  combatUI.style.display='block';
  updateCombatUI("Pertarungan dimulai — giliran pemain.");
  updateCombatBars();
}

function endCombat(won){
  inCombat = false;
  overlay.classList.remove('show');
  combatUI.style.display='none';
  if (won){
    player.x = player.x; // remain
    player.xp += currentEnemy.xp;
    player.gold += currentEnemy.gold;
    enemyKill++;
    document.getElementById('stat-kill').textContent = enemyKill;
    maybeLevelUp();
    // remove enemy
    enemies = enemies.filter(e=>e.id !== currentEnemy.id);
    // spawn replacement
    setTimeout(spawnEnemy,800);
  } else {
    // running away: small penalty
    player.gold = Math.max(0, player.gold - Math.floor(currentEnemy.gold*0.3));
  }
  currentEnemy = null;
}

function updateCombatUI(msg){
  combatLogEl.textContent = msg;
  combatPlayerInfo.textContent = `Lv ${player.level} • HP: ${player.hp}/${player.hpMax}`;
  combatEnemyInfo.textContent = `${currentEnemy.name} • HP: ${currentEnemy.hp}/${currentEnemy.hpMax}`;
  updateCombatBars();
}
function updateCombatBars(){
  combatPlayerHP.style.width = Math.max(0, (player.hp/player.hpMax)*100) + '%';
  combatEnemyHP.style.width = Math.max(0, (currentEnemy.hp/currentEnemy.hpMax)*100) + '%';
}

function damageCalc(attackerAtk, defenderDef){
  const base = Math.max(1, attackerAtk - Math.floor(defenderDef*0.6));
  const rnd = Math.floor(Math.random()*4) - 1; // -1..2
  return Math.max(1, base + rnd);
}

function combatPlayerAttack(){
  if(!inCombat || !playerTurn) return;
  const dmg = damageCalc(player.atk, currentEnemy.def);
  currentEnemy.hp -= dmg;
  updateCombatUI(`Kamu menyerang ${currentEnemy.name} dan memberi ${dmg} dmg.`);
  updateCombatBars();
  if (currentEnemy.hp <= 0){
    updateCombatUI(`Musuh ${currentEnemy.name} kalah! Kamu mendapat ${currentEnemy.xp} XP & ${currentEnemy.gold} gold.`);
    endCombat(true);
    playerTurn = false;
    refreshHud();
    return;
  }
  playerTurn = false;
  // enemy turn after short delay
  setTimeout(()=>{ combatEnemyAttack(); }, 700);
}

function combatEnemyAttack(){
  if(!inCombat || playerTurn) return;
  const dmg = damageCalc(currentEnemy.atk, player.def);
  player.hp -= dmg;
  updateCombatUI(`${currentEnemy.name} menyerangmu dan memberi ${dmg} dmg.`);
  if (player.hp <= 0){
    player.hp = 0;
    updateCombatBars();
    updateCombatUI(`Kamu dikalahkan... Game over.`);
    // simple game over behavior: reset game
    setTimeout(()=>{ resetGame(true); hideOverlay(); }, 900);
    inCombat = false;
    return;
  }
  playerTurn = true;
  updateCombatBars();
}

function combatUsePotion(){
  if(!inCombat || !playerTurn) return;
  if (player.potions<=0){
    updateCombatUI('Tidak ada potion!');
    return;
  }
  player.potions--;
  player.hp = Math.min(player.hpMax, player.hp + 40);
  updateCombatUI('Kamu menggunakan potion dan sembuh 40 HP.');
  playerTurn = false;
  updateCombatBars();
  setTimeout(()=>{ combatEnemyAttack(); }, 600);
}

function combatRun(){
  if(!inCombat) return;
  // chance to run
  const success = Math.random() < 0.6;
  if(success){
    updateCombatUI('Berhasil kabur!');
    endCombat(false);
  } else {
    updateCombatUI('Gagal kabur! Musuh mendapatkan giliran.');
    playerTurn = false;
    setTimeout(()=>combatEnemyAttack(), 700);
  }
}

// Use potion outside combat
function usePotion(){
  if (player.potions<=0) return alert('Tidak ada potion!');
  player.potions--;
  player.hp = Math.min(player.hpMax, player.hp + 40);
  refreshHud();
}

// XP & leveling
function maybeLevelUp(){
  const need = 30 + player.level * 20;
  if (player.xp >= need){
    player.xp -= need;
    player.level++;
    player.hpMax += 10;
    player.atk += 2;
    player.def += 1;
    player.hp = player.hpMax;
    alert(`Level up! Sekarang Level ${player.level}`);
    refreshHud();
    // recursive check
    maybeLevelUp();
  } else {
    refreshHud();
  }
}

// Save / highscore
function saveScore(){
  const list = JSON.parse(localStorage.getItem('rpg_scores')||'[]');
  const score = {name: prompt('Masukkan nama untuk top skor:', 'Player')||'Player', kills: enemyKill, gold: player.gold, date: Date.now()};
  list.push(score);
  list.sort((a,b)=> (b.kills + b.gold/50) - (a.kills + a.gold/50));
  localStorage.setItem('rpg_scores', JSON.stringify(list.slice(0,10)));
  loadHighscores();
}
function loadHighscores(){
  const list = JSON.parse(localStorage.getItem('rpg_scores')||'[]');
  const ol = document.getElementById('highscores');
  ol.innerHTML = '';
  list.slice(0,6).forEach(s=>{
    const li = document.createElement('li');
    const d = new Date(s.date);
    li.textContent = `${s.name} — Kills:${s.kills} Gold:${s.gold} • ${d.toLocaleDateString()}`;
    ol.appendChild(li);
  });
}
loadHighscores();

// ===== Main game logic & rendering =====
function resetGame(over=false){
  running = false;
  paused = false;
  enemies = [];
  map.length = 0;
  generateMap();
  player.x = 2; player.y = 2; player.hp = player.hpMax = 100; player.atk=8; player.def=2; player.level=1; player.xp=0; player.gold=0; player.potions=2;
  enemyKill = 0;
  document.getElementById('stat-kill').textContent = 0;
  document.getElementById('stat-time').textContent = '0s';
  for(let i=0;i<4;i++) spawnEnemy();
  refreshHud();
  if(!over) startGame();
}

function startGame(){
  running = true;
  paused = false;
  startTime = performance.now();
  elapsed = 0;
  gameLoop();
}

function refreshHud(){
  document.getElementById('player-level').textContent = player.level;
  document.getElementById('player-xp').textContent = player.xp;
  document.getElementById('player-gold').textContent = player.gold;
  document.getElementById('potion-count').textContent = player.potions;
  document.getElementById('player-hp-fill').style.width = Math.max(0, (player.hp/player.hpMax)*100) + '%';
  document.getElementById('stat-hp').textContent = `${player.hp}/${player.hpMax}`;
  document.getElementById('stat-attack').textContent = player.atk;
  document.getElementById('stat-def').textContent = player.def;
}

function update(delta){
  if(!running || paused || inCombat) return;

  // movement
  let dx=0, dy=0;
  if (keys['arrowup']||keys['w']||keys['up']) dy=-1;
  if (keys['arrowdown']||keys['s']||keys['down']) dy=1;
  if (keys['arrowleft']||keys['a']||keys['left']) dx=-1;
  if (keys['arrowright']||keys['d']||keys['right']) dx=1;

  if (dx!==0 || dy!==0){
    const nx = player.x + dx;
    const ny = player.y + dy;
    if (nx>=0 && nx<MAP_W && ny>=0 && ny<MAP_H && map[ny][nx]===0){
      player.x = nx; player.y = ny;
    }
  }

  // enemies simple behavior: move toward player sometimes
  enemies.forEach(en=>{
    if (Math.random()<0.02) return; // pause sometimes
    if (Math.random()<0.15){
      const dx = Math.sign(player.x - en.x);
      const dy = Math.sign(player.y - en.y);
      const nx = en.x + dx;
      const ny = en.y + dy;
      if (map[ny] && map[ny][nx] === 0 && !isOccupied(nx, ny, en.id)) {
        en.x = nx; en.y = ny;
      }
    } else {
      if (Math.random()<0.12){
        const nx = en.x + (Math.random()<0.5?1:-1);
        const ny = en.y + (Math.random()<0.5?1:-1);
        if (map[ny] && map[ny][nx] === 0 && !isOccupied(nx, ny, en.id)) {
          en.x = nx; en.y = ny;
        }
      }
    }
  });

  // check collision with enemies
  const collided = enemies.find(e => e.x===player.x && e.y===player.y);
  if (collided){
    // start combat
    startCombat(collided);
  }

  // spawn occasional enemy
  if (Math.random() < 0.008) spawnEnemy();
}

function isOccupied(x,y,exceptId){
  if (player.x===x && player.y===y) return true;
  for(const e of enemies) if (e.x===x && e.y===y && e.id !== exceptId) return true;
  return false;
}

function draw(){
  // clear
  ctx.clearRect(0,0,W,H);

  // draw tiles
  for(let y=0;y<MAP_H;y++){
    for(let x=0;x<MAP_W;x++){
      const px = x*tileSize;
      const py = y*tileSize;
      if (map[y][x]===1){
        ctx.fillStyle = '#273146';
        ctx.fillRect(px,py,tileSize,tileSize);
      } else {
        // grass with subtle noise
        ctx.fillStyle = '#0b203a';
        ctx.fillRect(px,py,tileSize,tileSize);
        // small details
        if ((x+y)%7===0){
          ctx.fillStyle = 'rgba(255,255,255,0.02)';
          ctx.fillRect(px+2,py+2,2,2);
        }
      }
    }
  }

  // draw enemies
  enemies.forEach(e=>{
    const px = e.x*tileSize + tileSize/2;
    const py = e.y*tileSize + tileSize/2;
    // body
    ctx.beginPath();
    ctx.fillStyle = '#9b2b2b';
    ctx.arc(px,py,tileSize*0.36,0,Math.PI*2);
    ctx.fill();
    // eyes
    ctx.fillStyle = '#fff';
    ctx.fillRect(px-6,py-4,4,4);
    ctx.fillRect(px+2,py-4,4,4);
    // name
    ctx.fillStyle = '#ffd9b3';
    ctx.font = `${Math.floor(tileSize/5)}px sans-serif`;
    ctx.textAlign='center';
    ctx.fillText(e.name, px, py - tileSize*0.52);
  });

  // draw player
  const px = player.x*tileSize + tileSize/2;
  const py = player.y*tileSize + tileSize/2;
  // shadow
  ctx.beginPath();
  ctx.ellipse(px,py+tileSize*0.32,tileSize*0.42,tileSize*0.24,0,0,Math.PI*2);
  ctx.fillStyle = 'rgba(0,0,0,0.25)';
  ctx.fill();
  // body
  ctx.beginPath();
  ctx.fillStyle = '#3fb0ff';
  ctx.arc(px,py,tileSize*0.42,0,Math.PI*2);
  ctx.fill();
  // face
  ctx.fillStyle = '#072b3c';
  ctx.fillRect(px-6,py-8,12,12);
  // name
  ctx.fillStyle = '#fff';
  ctx.font = `${Math.floor(tileSize/5)}px sans-serif`;
  ctx.textAlign='center';
  ctx.fillText('You', px, py - tileSize*0.52);

  // mini-grid border
  ctx.strokeStyle = 'rgba(255,255,255,0.03)';
  ctx.lineWidth = 1;
  ctx.strokeRect(0,0,MAP_W*tileSize,MAP_H*tileSize);
}

// main loop
let last = performance.now();
function gameLoop(now=performance.now()){
  const dt = (now - last)/1000;
  last = now;
  if (running && !paused) {
    update(dt);
    elapsed = Math.floor((performance.now() - startTime)/1000);
    document.getElementById('stat-time').textContent = elapsed + 's';
  }
  draw();
  refreshHud();
  requestAnimationFrame(gameLoop);
}

// initial drawing
draw();
refreshHud();

// ===== helpers & misc UI =====
function refreshAll(){
  refreshHud();
  loadHighscores();
}
refreshAll();

// handle overlay close by clicking outside menu
overlay.addEventListener('click', (e)=>{
  if (e.target === overlay) hideOverlay();
});

// mobile-friendly: prevent scroll
document.body.addEventListener('touchmove', function(e){ if (running) e.preventDefault(); }, {passive:false});

// simple autoplayers for demo: start by default
// startGame();

// expose some debug on window
window._game = { player, enemies, map, spawnEnemy, resetGame };

// Save score quickly when press S (shortcut)
window.addEventListener('keydown',(e)=>{
  if(e.key.toLowerCase()==='p'){ // P untuk potion
    usePotion();
  }
  if(e.key.toLowerCase()==='k'){ // K untuk kill spawn enemy (debug)
    spawnEnemy();
  }
  if(e.key.toLowerCase()==='t'){ // T untuk save score
    saveScore();
  }
});
</script>
</body>
</html>